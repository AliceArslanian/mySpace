<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Space App</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div style="color: rgb(252, 250, 250)">
      <h1 style="text-align: center">Welcome To My Space App</h1>
      <p>
        This Site will give you some insights about the SpaceX using some data.
      </p>
      <div id="history_section">
        Are you interested in our history? You could click on the button to read
        more details.
        <button id="history_button">Click me</button>
      </div>
      <div id="history"></div>
      <div id="number_of_capsules">Number Of capsules is:</div>
      <div id="status_of_capsules">Each status:</div>
    </div>
  </body>
  <script>
    const url = "https://api.spacexdata.com/v4";
    const crewSuffix = "crew";
    async function _fetchCrewMembers() {
      try {
        const response = await fetch(`${url}/crew`);
        if (!response.ok) {
          throw new Error(`Failed to fetch. Status code: ${status.status}`);
        }
        // console.log(response.json().then((res) => console.log(res)));
        const result = await response.json();
        return response;
      } catch (e) {
        console.log(e);
      }
    }

    function _fetchCapsules() {
      fetch(`${url}/capsules`)
        .then((res) => res.json())
        .then((res) => {
          var numberOfCapsules = document.getElementById("number_of_capsules");
          var statusOfCapsules = document.getElementById("status_of_capsules");
          numberOfCapsules.append(res.length);
          let test;
          res.forEach((r) => {
            test = test + r.last_update;
          });
        });
    }

    var historyButton = document.getElementById("history_button");
    historyButton.addEventListener("click", function (e) {
      _fetchHistory();
    });
    async function _fetchHistory() {
      var historyButton = document.getElementById("history_button");
      var historySection = document.getElementById("history");
      let text = "";
      if (historyButton.innerText === "Click me") {
        try {
          historyButton.innerText = "hide";
          const response = await fetch(`${url}/history`);
          if (!response.ok) {
            throw new Error(`Failed to fetch. Status code: ${status.status}`);
          }
          const result = await response.json();

          result.forEach((r) => {
            text = text + r.details;
          });
          historySection.append(text);
          return response;
        } catch (e) {
          console.log(e);
        }
      } else {
        text = "";
        document.getElementById("history").innerHTML = "";
        historyButton.innerText = "Click me";
        return;
      }
    }

    _fetchCrewMembers();
    _fetchCapsules();
  </script>
</html>
